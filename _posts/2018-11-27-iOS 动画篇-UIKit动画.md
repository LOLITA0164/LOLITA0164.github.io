---
layout:     post
title:      iOS åŠ¨ç”»ç¯‡ - UIKitåŠ¨ç”»
subtitle:   UIKitåŠ¨ç”»
date:       2018-11-27-iOS 
author:     LOLITA0164
header-img: img/post-bg-animation.jpg
catalog: true
tags: 
    - iOS
    - åŠ¨ç”»
---

## ç®€å•ä½¿ç”¨ç¯‡

#### ç®€ä»‹

iOS10å¸¦æ¥äº†å¾ˆå¤šæ–°ç‰¹æ€§ï¼Œå…¶ä¸­æœ‰ä¸ª `UIViewPropertyAnimator` ç±»ï¼Œå…‰ä»åå­—ä¸Šå°±å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªæ“ä½œå±æ€§åŠ¨ç”»çš„ç±»ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªç±»èƒ½å¤Ÿè®©æˆ‘ä»¬å¯¹è§†å›¾è¿›è¡ŒåŠ¨ç”»æ§åˆ¶ï¼Œæˆ‘ä»¬é™¤äº†å¯è¿›è¡Œæ­£å¸¸çš„è¿è¡ŒåŠ¨ç”»ï¼Œå¦‚å¼€å§‹ã€æš‚åœã€é‡å¯ç­‰æ“ä½œåŠ¨ç”»ï¼Œè¿˜å¯ä»¥å°†åŠ¨ç”»è½¬æ¢ä¸ºäº¤äº’å¼åŠ¨ç”»ï¼Œä»»æ„çš„æ§åˆ¶æ—¶é—´ã€‚

å®ƒå¯ä»¥å¯¹è§†å›¾çš„å¯åŠ¨ç”»å±æ€§è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚frameï¼Œcenterï¼Œalpha å’Œ transformç­‰ï¼Œå¹¶ä¸”å¯ä»¥ä»»æ„çš„æ·»åŠ å¤šä¸ªåŠ¨ç”»å—å’Œå®Œæˆå—ï¼Œç›¸æ¯”äºä¹‹å‰çš„ UIView åŠ¨ç”»ï¼Œå®ƒæ”¹å˜äº†æˆ‘ä»¬ä¹ æƒ¯çš„åŠ¨ç”»æµç¨‹ï¼Œå˜å¾—æ›´åŠ çµæ´»ã€‚

#### ç®€å•ä¾‹å­

æ”¹å˜ä¸€ä¸ªè§†å›¾çš„ center åŠ¨ç”»ï¼š

```
// åˆ›å»ºåŠ¨ç”»å™¨
UIViewPropertyAnimator* animator = [[UIViewPropertyAnimator alloc] initWithDuration:1.0
                                                                              curve:UIViewAnimationCurveEaseOut
                                                                         animations:^{
    self.contentView.center = self.view.center;
}];
// å¼€å§‹åŠ¨ç”»
[animator startAnimation];
```

![ç§»åŠ¨ä½ç½®çš„åŠ¨ç”»](https://ws3.sinaimg.cn/large/006tNbRwgy1fxnr35adqsg308w03uglk.gif)

åœ¨ä½¿ç”¨ UIViewPropertyAnimator åšåŠ¨ç”»æ—¶ï¼Œéœ€è¦å…³æ³¨ä¸‹é¢å‡ ä¸ªç‚¹ï¼š

- åŒ…å«æ”¹å˜ä¸€ä¸ªæˆ–å¤šä¸ªè§†å›¾å±æ€§çš„åŠ¨ç”»å—
- ç”¨äºå®šä¹‰åŠ¨ç”»è¿è¡Œè¿‡ç¨‹ä¸­çš„æ—¶é—´é€Ÿç‡æ›²çº¿
- åŠ¨ç”»çš„æŒç»­æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰
- åŠ¨ç”»å®Œæˆå—ï¼ˆå¯é€‰ï¼‰

åœ¨ä¸Šé¢çš„ç®€å•å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨1ç§’çš„æ—¶é—´å†…ï¼Œæ”¹å˜äº†è§†å›¾çš„ä¸­å¿ƒä½ç½®ï¼Œå…¶ä¸­åŠ¨ç”»å—å³ä¸º animations çš„ä»£ç å—ï¼Œåœ¨æ­¤ä»£ç å—ä¸­æˆ‘ä»¬å¯ä»¥é’ˆå¯¹å¯åŠ¨åŠ¨è§„åˆ’è¿›è¡Œæ–°å¢æ”¹å˜ã€‚å¯¹äºè¿è¡Œçš„åŠ¨ç”»æ—¶é—´é€Ÿç‡ï¼ŒåŠ¨ç”»å™¨ animator æ”¯æŒ UIKit åŠ¨ç”»ä¸­çš„æ—¶é—´é€Ÿç‡å‡½æ•°ï¼Œå³linearã€ease-inã€ease-outç­‰ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬æ‰€åˆ›å»ºçš„åŠ¨ç”»å™¨éƒ½æ˜¯å¤„äºéæ´»è·ƒçŠ¶æ€ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨`-startAnimation`å°†å…¶å˜ä¸ºæ´»è·ƒçŠ¶æ€æ‰§è¡ŒåŠ¨ç”»ã€‚

#### åˆå§‹åŒ–åŠ¨ç”»å™¨

UIViewPropertyAnimator ä¸ºæˆ‘ä»¬æä¾›äº†å¤šä¸ªå¿«æ·åˆ›å»ºåŠ¨ç”»å™¨çš„æ–¹æ³•ã€‚

- ä½¿ç”¨å†…ç½®`æ—¶é—´é€Ÿç‡å‡½æ•°`

`-initWithDuration:curve:animations:`

è¿™ç§æ–¹å¼å°±æ˜¯æˆ‘ä»¬èŠ‚ä¾‹å­ä¸­çš„ä½¿ç”¨åˆ°çš„åˆ›å»ºæ–¹æ³•ï¼Œcurve å‚æ•°å³æ—¶é—´é€Ÿç‡å‡½æ•°ï¼Œå…¶æ‰€æ”¯æŒçš„ä»¥ä¸‹å‡ ç§ï¼š

```
UIViewAnimationCurveEaseInOut //ç¼“è¿›ç¼“å‡º
UIViewAnimationCurveEaseIn //ç¼“è¿›
UIViewAnimationCurveEaseOut //ç¼“å‡º
UIViewAnimationCurveLinear //çº¿æ€§åŒ€é€Ÿ
```

![å››ç§å†…ç½®æ—¶é—´é€Ÿç‡](https://ws2.sinaimg.cn/large/006tNbRwgy1fxntp7ebyxg308w08ygmk.gif)

å¦‚æœæ‰€è¯´ UIKit æä¾›çš„é€Ÿç‡æ›²çº¿å‡½æ•°ä¸èƒ½å¤Ÿæ»¡è¶³ä½ çš„æ‰§è¡ŒåŠ¨ç”»çš„é€Ÿç‡è¦æ±‚ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ¥åˆ›å»ºè‡ªå·±çš„é€Ÿåº¦æ›²çº¿ã€‚

- ä½¿ç”¨`ä¸‰æ¬¡è´å¡å°”æ›²çº¿`

`-initWithDuration:controlPoint1:controlPoint2:animations:`

ä¸‰æ¬¡è´å¡å°”æ›²çº¿çš„èµ·ç‚¹ä¸ºï¼ˆ0,0ï¼‰ä¸”å…¶ç»ˆç‚¹ä¸ºï¼ˆ1,1ï¼‰ï¼Œå› æ­¤ä¸¤ä¸ªæ§åˆ¶ç‚¹çš„å–å€¼èŒƒå›´æ˜¯(0,1)ã€‚

- ä½¿ç”¨`åŸºäºå¼¹ç°§çš„å¼¹æ€§`

`-initWithDuration:dampingRatio:animations:`

`dampingRatio:`æ‰€å¯¹åº”çš„å‚æ•°å«åšé˜»å°¼ï¼Œä¸€èˆ¬å»å€¼ä¸ºï¼ˆ0ï¼Œ1ï¼‰è¾ƒä½çš„é˜»å°¼å€¼å¯¹åº”è¾ƒå°é˜»åŠ›å’Œåœ¨é™æ­¢ä¹‹å‰æ›´å¤šæ›´å¤§çš„æŒ¯è¡ã€‚åä¹‹åˆ™é˜»åŠ›å¤§ï¼ŒæŒ¯è¡å°‘è€Œå°ã€‚ä¾‹å¦‚ä½ æƒ³ä¸æŒ¯è¡çš„æƒ…å†µä¸‹å¹³æ»‘çš„å‡é€ŸåŠ¨ç”»ï¼Œå°±å¯ä»¥æŒ‡å®šå€¼ä¸º1ã€‚

```
// åˆ›å»ºåŠ¨ç”»å™¨
UIViewPropertyAnimator* animator = [[UIViewPropertyAnimator alloc] initWithDuration:1.0
                                                                       dampingRatio:0.35
                                                                         animations:^{
    self.contentView.center = CGPointMake(self.view.center.x+100, self.view.center.y);
}];
// å¼€å§‹åŠ¨ç”»
[animator startAnimation];
```

![å¼¹æ€§åŠ¨ç”»](https://ws1.sinaimg.cn/large/006tNbRwgy1fxns6t8wzbg308w042jre.gif) 

- ä½¿ç”¨`è‡ªå®šä¹‰æ—¶é—´é€Ÿç‡å¯¹è±¡`

`-initWithDuration:timingParameters:`

è¯¥æ–¹æ³•éœ€è¦ä½ æä¾›æ”¯æŒ `UITimingCurveProvider` åè®®çš„å¯¹è±¡ï¼Œå¦‚æœä½ è¦è‡ªå®šä¹‰å®ç°æ­¤åè®®ï¼Œå¿…é¡»æä¾›æ‰€æœ‰å±æ€§çš„å®ç°ã€‚

ç³»ç»Ÿæœ‰ä¸¤ä¸ªéµå¾ªè¯¥åè®®çš„ç±»

```
UICubicTimingParameters 
UISpringTimingParameters
```
å¦‚æœä½ æŸ¥çœ‹`UICubicTimingParameters`ç±»æ—¶ï¼Œä½ ä¼šå‘ç°ï¼Œè¿™ä¸ªç±»ä¹Ÿåªæ˜¯æä¾›äº†æ”¯æŒ UIKit å†…ç½®çš„æ—¶é—´é€Ÿç‡æ›²çº¿å’Œä¸‰æ¬¡è´å¡å°”æ›²çº¿ã€‚ç±»ä¼¼çš„`UISpringTimingParameters `ä¹Ÿæä¾›äº†`CASpringAnimation`ä¸­çš„å‡ ä¸ªç‰©ç†å‚æ•°ã€‚

ç¤ºä¾‹ï¼šæˆ‘ä»¬é€šè¿‡è¯¥æ–¹æ³•å®ç°ä¸€ä¸‹å’Œä¸Šä¸€ä¸ªæ–¹æ³•ç±»ä¼¼çš„æ•ˆæœ

```
// å¼¹æ€§çš„æ—¶é—´é€Ÿç‡
UISpringTimingParameters* parameters = [[UISpringTimingParameters alloc] initWithDampingRatio:0.35];
// åˆ›å»ºåŠ¨ç”»å™¨
UIViewPropertyAnimator* animator = [[UIViewPropertyAnimator alloc] initWithDuration:1.0 timingParameters:parameters];
// ç”±äºè¯¥åˆ›å»ºæ–¹æ³•æ²¡æœ‰åŠ¨ç”»å—ï¼Œå› æ­¤éœ€è¦è‡ªè¡Œè¿½åŠ 
[animator addAnimations:^{
    self.contentView.center = CGPointMake(self.view.center.x+100, self.view.center.y);
}];
// å¼€å§‹åŠ¨ç”»
[animator startAnimation];
```

![å¼¹æ€§çš„æ—¶é—´é€Ÿç‡](https://ws1.sinaimg.cn/large/006tNbRwgy1fxntg4kt4rg308w046jre.gif)


å¦‚æœè¯´ï¼Œä½ å—ä¸äº†æ¯æ¬¡éƒ½éœ€è¦ä¸»åŠ¨è°ƒç”¨`-startAnimation`æ–¹æ³•æ¥å¯åŠ¨è§†å›¾åŠ¨ç”»ï¼Œè¿˜æ˜¯ä¹ æƒ¯ UIView çš„å¿«æ·ä½¿ç”¨ï¼ğŸ‘Œï¼Œè‹¹æœä¼¼ä¹æ³¨æ„åˆ°äº†è¿™ä¸€ç‚¹ï¼Œä¸ºäº†é€‚åº”å¼€å‘è€…çš„ä¹ æƒ¯ï¼Œé™¤äº†ä¸Šè¿°å‡ ç§åˆ›å»ºåŠ¨ç”»å™¨çš„æ–¹å¼ï¼Œè¿˜æœ‰ä¸€ç§å¯ä»¥å¯åŠ¨å¼€å¯åŠ¨ç”»å¹¶èƒ½è¿”å›å½“å‰åŠ¨ç”»å™¨çš„æ–¹æ³•ã€‚

- ç±»æ–¹æ³•ä¾¿æ·

`+ runningPropertyAnimatorWithDuration:delay:options:animations:completion:`

è¯¥æ–¹æ³•æä¾›äº†åŠ¨ç”»çš„å‡ ä¸ªç›¸å¯¹æ¯”è¾ƒé‡è¦çš„å‚æ•°ï¼Œå¦‚åŠ¨ç”»æ‰§è¡Œæ—¶é—´ã€å»¶è¿Ÿæ—¶é—´ã€æ—¶é—´é€Ÿç‡ã€åŠ¨ç”»å—ã€å®Œæˆå—ã€‚è¯¥æ–¹æ³•å…¼å®¹äº† UIView åŠ¨ç”»å—çš„å½¢å¼ã€‚

```
[UIViewPropertyAnimator runningPropertyAnimatorWithDuration:1.0
                                                      delay:0
                                                    options:UIViewAnimationCurveEaseOut
                                                 animations:^{
    self.contentView.center = CGPointMake(self.view.center.x+100, self.view.center.y);
}
                                                 completion:^(UIViewAnimatingPosition finalPosition) {}];
```

![å¿«æ·ä½¿ç”¨](https://ws4.sinaimg.cn/large/006tNbRwgy1fxnu63wgrsg308w04ct8p.gif)

#### æ§åˆ¶åŠ¨ç”»

UIViewPropertyAnimator éµå®ˆäº† UIViewImplicitlyAnimating åè®®ï¼Œè€ŒUIViewImplicitlyAnimating åè®®æ˜¯ UIViewAnimating åè®®çš„å­ç±»ï¼Œè¯¥ç±»å®šä¹‰äº†å¦‚ä½•æ§åˆ¶åŠ¨ç”»çš„åè®®ã€‚é™¤äº†ä¸Šä¸€èŠ‚ä¸­ä½¿ç”¨åˆ°çš„`-startAnimation`æ–¹æ³•ï¼Œè¿˜æœ‰å…¶ä»–å‡ ä¸ªæ§åˆ¶åŠ¨ç”»çš„æ–¹æ³•ã€‚

- å¼€å§‹æ‰§è¡ŒåŠ¨ç”»

`-startAnimation`ï¼šæ–¹æ³•å¯ä»¥å¯åŠ¨åŠ¨ç”»æˆ–è€…åœ¨æš‚åœåŠ¨ç”»åæ¢å¤åŠ¨ç”»ã€‚
`-startAnimationAfterDelay:`ï¼šå’Œä¸Šé¢æ–¹æ³•ç±»ä¼¼ï¼Œä¸è¿‡å¯ä»¥æŒ‡å®šå»¶è¿Ÿæ‰§è¡Œçš„æ—¶é—´

- æš‚åœåŠ¨ç”»

`-pauseAnimation`ï¼šæš‚åœåŠ¨ç”»ï¼Œå½“ä½¿ç”¨è¯¥æ–¹æ³•åï¼ŒåŠ¨ç”»ä¼šåœç•™åœ¨â€œå½“å‰ä½ç½®â€ï¼Œä¼šä¿æŒå½“å‰çš„çŠ¶æ€ã€‚æš‚åœåå¯ä»¥ä½¿ç”¨`-startAnimation`æ¢å¤ï¼Œæ¢å¤çš„åŠ¨ç”»ä¼šä»â€œå½“å‰ä½ç½®â€ç»§ç»­å‰©ä½™çš„åŠ¨ç”»ï¼ŒåŒ…æ‹¬å‰©ä½™çš„æ—¶é—´ã€‚

ç¤ºä¾‹ï¼šæˆ‘ä»¬æ‰§è¡Œä¸€ä¸ª2ç§’æ—¶é•¿çš„åŠ¨ç”»ï¼Œåœ¨1ç§’å¤„åœæ­¢ï¼Œå»¶è¿Ÿ1ç§’åæ¢å¤åŠ¨ç”»ï¼Œè®©å…¶ç»§ç»­æ‰§è¡Œã€‚

```
UIViewPropertyAnimator* animator = [UIViewPropertyAnimator runningPropertyAnimatorWithDuration:2.0 delay:0 options:UIViewAnimationOptionCurveLinear animations:^{
    self.contentView.center = CGPointMake(self.view.center.x+100, self.view.center.y);
} completion:nil];
dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
    // æš‚åœå½“å‰åŠ¨ç”»
    [animator pauseAnimation];
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
        // æ¢å¤åŠ¨ç”»
        [animator startAnimation];
    });
});
```

![åŠ¨ç”»çš„æš‚åœå’Œæ¢å¤](https://ws3.sinaimg.cn/large/006tNbRwgy1fxnwz9xjd3g308w042dg3.gif)

- `stopAnimation:`ï¼šåœæ­¢åŠ¨ç”»

åœæ­¢åŠ¨ç”»æœ‰å¤šç§æƒ…å†µï¼Œç”±äºåŠ¨ç”»çŠ¶æ€çš„æœºåˆ¶ï¼ˆè¿›é˜¶ç¯‡ä¼šè®²ï¼‰çš„å­˜åœ¨ï¼Œå½“æˆ‘ä»¬åœæ­¢åŠ¨ç”»åï¼Œè¿™äº›åŠ¨ç”»çŠ¶æ€ä¿¡æ¯ä½•å»ä½•ä»ï¼Ÿè‹¹æœç»™å‡ºäº†ä¸¤ç§çš„å»å¤„ï¼Œä¸€ç§æ—¶æ¸…é™¤æ‰€æœ‰çŠ¶æ€ä¿¡æ¯ï¼ŒåŠ¨ç”»å™¨é‡ç½®ä¸ºåˆå§‹çš„éæ´»è·ƒçŠ¶æ€ï¼Œä»¥ç­‰å¾…ä¸‹ä¸€ä¸ªåŠ¨ç”»ï¼›å¦å¤–ä¸€ç§æ˜¯ä¿ç•™æ‰€æœ‰çŠ¶æ€ä¿¡æ¯ï¼Œç­‰å¾…ä¸‹ä¸€æ­¥æ“ä½œã€‚è¿™é‡Œçš„ withoutFinishing å‚æ•°å°±æ˜¯ç”¨æ¥æŒ‡æ˜å»å¤„ã€‚

å‚æ•° withoutFinishingï¼Œè¡¨ç¤ºæ˜¯å¦åº”æ‰§è¡Œä»»ä½•æœ€ç»ˆæ“ä½œã€‚å¦‚æœå€¼ä¸º YESï¼Œåˆ™ä¼šæ¸…é™¤ä»»ä½•åŠ¨ç”»å¹¶å°†åŠ¨ç”»å™¨é‡ç½®ä¸ºéæ´»è·ƒçŠ¶æ€ï¼Œå¹¶ä¸”ä¸ä¼šæ‰§è¡Œå®Œæˆå—çš„å›è°ƒã€‚

ç¤ºä¾‹ï¼šæˆ‘ä»¬æ‰§è¡Œä¸€ä¸ª2ç§’çš„åŠ¨ç”»ï¼Œåœ¨ä¸€ç§’å¤„åœæ­¢å½“å‰åŠ¨ç”»ï¼Œå¹¶ä¸”åœ¨å®Œæˆå—ä¸­å°†è§†å›¾çš„èƒŒæ™¯è‰²æ›´æ”¹ä¸ºçº¢è‰²ã€‚

```
UIViewPropertyAnimator* animator = [UIViewPropertyAnimator runningPropertyAnimatorWithDuration:2.0 delay:0 options:UIViewAnimationOptionCurveLinear animations:^{
    self.contentView.center = CGPointMake(self.view.center.x+100, self.view.center.y);
} completion:^(UIViewAnimatingPosition finalPosition) {
    // åŠ¨ç”»çš„å®Œæˆå›è°ƒ
    self.contentView.backgroundColor = UIColor.redColor;
}];
dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
    [animator stopAnimation:YES];
});
```

![withoutFinishingä¸ºYESçš„æƒ…å†µ](https://ws3.sinaimg.cn/large/006tNbRwgy1fxnxl082ufg308w03wjre.gif)

è¿è¡Œç»“æœå‘ç°ï¼ŒåŠ¨ç”»åœ¨1ç§’å¤„åœæ­¢äº†ï¼Œä½†æ˜¯å¹¶æ²¡å˜æˆçº¢è‰²èƒŒæ™¯ï¼Œè¿™è¯´æ˜ï¼Œæ­¤æ—¶çš„åŠ¨ç”»å™¨å¹¶ä¸ä¼šæ‰§è¡Œå®Œæˆå—ã€‚

å½“å‚æ•°ä¸º NO æ—¶ï¼ŒåŠ¨ç”»å™¨çŠ¶æ€ä¸º stoppedï¼Œæ­¤æ—¶é€šå¸¸ä¼šé…åˆ`finishAnimationAtPositionï¼š`ä½¿ç”¨ï¼Œè¯¥æ–¹æ³•å¯ä»¥å¸®åŠ©åŠ¨ç”»å™¨æ‰§è¡Œæœ€ç»ˆçš„å®Œæˆå—çš„å†…å®¹ï¼Œå½“ç„¶ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„ç›®çš„æ˜¯åœä¸‹å½“å‰åŠ¨ç”»ï¼Œè®©ä½ å®Œæˆæ­¤åˆ»éœ€è¦å®Œæˆçš„å†…å®¹ï¼Œå¦‚å…¶ä»–åŠ¨ç”»ï¼Œä¹‹åï¼Œä½ å†ä½¿ç”¨`finishAnimationAtPositionï¼š`å®ŒæˆåŠ¨ç”»çš„å›è°ƒä»¥åŠåŠ¨ç”»éœ€è¦åœæ­¢çš„ä½ç½®ã€‚

åœ¨æ¼”ç¤ºç¤ºä¾‹ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹`finishAnimationAtPositionï¼š`ã€‚

- `-finishAnimationAtPosition:`ï¼šç»“æŸåŠ¨ç”»

è¯¥æ–¹æ³•å¯ä»¥å°†å¤„äº stopped çŠ¶æ€çš„åŠ¨ç”»é‡ç½®ä¸ºéæ´»è·ƒçŠ¶æ€ï¼Œå¹¶æ‰§è¡ŒåŠ¨ç”»çš„å®Œæˆå—ã€‚

æ­¤æ–¹æ³•é€šå¸¸é…åˆ `-stopAnimation:` ä½¿ç”¨ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•å¿…é¡»åœ¨åŠ¨ç”»å™¨çŠ¶æ€ä¸º stopped çŠ¶æ€æ‰å¯ä»¥ï¼Œå¦åˆ™ä¼šå‡ºç°é”™è¯¯ã€‚è¯¥æ–¹æ³•çš„ `UIViewAnimatingPosition` å‚æ•°æœ‰ä¸€ä¸‹ä¸‰ç§ï¼š

```
UIViewAnimatingPositionEnd //åŠ¨ç”»çš„ç»ˆç‚¹ä½ç½®
UIViewAnimatingPositionStart //åŠ¨ç”»çš„å¼€å¤´ä½ç½®
UIViewAnimatingPositionCurrent //åŠ¨ç”»å½“å‰ä½ç½®
```
æŒ‡å®š UIViewAnimatingPositionCurrent ä»¥ä½¿è§†å›¾å±æ€§ä¸å…¶å½“å‰å€¼ä¿æŒä¸å˜ã€‚

ç¤ºä¾‹ï¼šæˆ‘ä»¬ç»§ç»­ä¹‹å‰çš„ä¾‹å­ï¼Œè¿™æ¬¡æˆ‘ä»¬é…åˆ `-finishAnimationAtPosition:` æ–¹æ³•ä½¿ç”¨ã€‚

```
UIViewPropertyAnimator* animator = [UIViewPropertyAnimator runningPropertyAnimatorWithDuration:2.0 delay:0 options:UIViewAnimationOptionCurveLinear animations:^{
    self.contentView.center = CGPointMake(self.view.center.x+100, self.view.center.y);
} completion:^(UIViewAnimatingPosition finalPosition) {
    // åŠ¨ç”»çš„å®Œæˆå›è°ƒ
    self.contentView.backgroundColor = UIColor.redColor;
}];
dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
    [animator stopAnimation:NO];
    // åŠ¨ç”»å™¨çš„çŠ¶æ€å¿…é¡»æ˜¯stopped
    if (animator.state==UIViewAnimatingStateStopped) {
        [animator finishAnimationAtPosition:UIViewAnimatingPositionCurrent];
    }
});
```

![withoutFinishingä¸ºNOçš„æƒ…å†µ](https://ws1.sinaimg.cn/large/006tNbRwgy1fxo01lu6ctg308w03amx6.gif)

æˆ‘ä»¬å‘ç°ï¼ŒåŠ¨ç”»è¿è¡Œ1ç§’ååœæ­¢äº†ï¼Œå¹¶ä¸”èƒŒæ™¯è‰²è¢«å¡«å……ä¸ºçº¢è‰²ï¼Œè¿™è¯´æ˜`-finishAnimationAtPosition:`è§¦å‘å®Œæˆå—ï¼Œè¿™ä¸€ç‚¹å’Œä¹‹å‰çš„ä¾‹å­æ˜¯ä¸åŒçš„ã€‚å¦å¤–ï¼Œæˆ‘ä»¬çœ‹åˆ°è§†å›¾åœä¸‹æ¥ä¹‹åå°±ä¿æŒåœ¨äº†å½“å‰ä½ç½®ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç»™çš„ç»“æŸä½ç½®å°±æ˜¯ Currentã€‚ä¸‹å›¾æ¼”ç¤ºäº†ä½ç½®çš„ä¸åŒå‚æ•°çš„æ•ˆæœã€‚

![startã€currentã€endä¸‰ç§ä¸åŒä½ç½®](https://ws4.sinaimg.cn/large/006tNbRwgy1fxo0c6nbd4g308w062jrn.gif)

#### äº¤äº’å¼åŠ¨ç”»

**fractionComplete å±æ€§**

UIViewPropertyAnimator ç±»ä¸­æœ‰ä¸€ä¸ª`fractionComplete`å±æ€§ï¼Œè¿™ä¸ªå±æ€§è¡¨ç¤ºå½“å‰åŠ¨ç”»çš„å®Œæˆçš„ç™¾åˆ†æ¯”ï¼Œå¹¶ä¸”è¿™ä¸ªå±æ€§ä¸æ˜¯åªè¯»çš„å±æ€§ï¼Œè¿™è¯´æ˜æˆ‘ä»¬å¯ä»¥ç²¾å‡†çš„æ§åˆ¶åŠ¨ç”»çš„æ•´ä¸ªè¿‡ç¨‹ã€‚åˆ©ç”¨å®ƒï¼Œæˆ‘ä»¬å¯ä»¥åˆ¶ä½œäº¤äº’å¼åŠ¨ç”»ã€‚äº¤äº’å¼åŠ¨ç”»çš„å¥½å¤„æ˜¯ï¼šå¯¹äºå¤šä¸ªè§†å›¾ã€éå¸¸å¤æ‚çš„è§†å›¾å˜åŒ–åŠ ä»¥æ§åˆ¶å˜å¾—ç®€å•ã€‚

ç¤ºä¾‹ï¼š

```
@interface ViewController ()
@property (weak, nonatomic) IBOutlet UIView *blueView;
@property (weak, nonatomic) IBOutlet UIView *redView;
@property (weak, nonatomic) IBOutlet UISlider *slider;
@property (strong, nonatomic) UIViewPropertyAnimator* animator;
@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // åˆå§‹åŒ–åŠ¨ç”»å™¨
    self.animator = [[UIViewPropertyAnimator alloc] initWithDuration:2.0 curve:UIViewAnimationCurveLinear animations:^{
        // çº¢è‰²è§†å›¾
        CGRect fram = CGRectMake(self.slider.center.x - 50/2.0, self.slider.center.y - 100, 50, 50);
        self.redView.frame = fram;
        self.redView.transform = CGAffineTransformMakeRotation(M_PI);
        self.redView.backgroundColor = UIColor.blueColor;
        // é¢œè‰²è§†å›¾
        self.blueView.frame = fram;
        self.blueView.transform = self.redView.transform;
        self.blueView.backgroundColor = UIColor.redColor;
    }];
    [self.slider addTarget:self action:@selector(change:) forControlEvents:UIControlEventValueChanged];
}

-(void)change:(UISlider*)slider{
    CGFloat value = slider.value;
    // æ›´æ”¹åŠ¨ç”»å®Œæˆåº¦
    self.animator.fractionComplete = value;
}
```

![æ§åˆ¶ä¸¤ä¸ªè§†å›¾ä¹‹é—´çš„åŠ¨ç”»](https://ws4.sinaimg.cn/large/006tNbRwgy1fxo2hi1w02g308w0c0wn3.gif)

#### ä¿®æ”¹åŠ¨ç”»



## è¿›é˜¶ç¯‡

#### åŠ¨ç”»åè®®

æš‚åœå’Œå»¶è¿Ÿå¼€å§‹çš„é”™è¯¯

åŠ¨ç”»çŠ¶æ€çš„å˜æ¢ä»¥åŠåœæ­¢åŠ¨ç”»å’ŒfinishAnimationAtPositionï¼Œå®Œæˆå—çš„ä½¿ç”¨


#### ä¿®æ”¹åŠ¨ç”»åè®®


#### åŠ¨ç”»å™¨
























